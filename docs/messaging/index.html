<!DOCTYPE html>
<html class="no-js">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1" charset="UTF-8">
    <title>AXP Messaging</title>
    <link href="images/logo-icon.svg" rel="icon" type="image/svg">
    <script>var pathToRoot = "";</script>
    <script>document.documentElement.classList.replace("no-js","js");</script>
    <script>const storage = localStorage.getItem("dokka-dark-mode")
    if (storage == null) {
        const osDarkSchemePreferred = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
        if (osDarkSchemePreferred === true) {
            document.getElementsByTagName("html")[0].classList.add("theme-dark")
        }
    } else {
        const savedDarkMode = JSON.parse(storage)
        if(savedDarkMode === true) {
            document.getElementsByTagName("html")[0].classList.add("theme-dark")
        }
    }
    </script>
<script type="text/javascript" src="https://unpkg.com/kotlin-playground@1/dist/playground.min.js" async="async"></script>
<script type="text/javascript" src="scripts/sourceset_dependencies.js" async="async"></script>
<link href="styles/style.css" rel="Stylesheet">
<link href="styles/main.css" rel="Stylesheet">
<link href="styles/prism.css" rel="Stylesheet">
<link href="styles/logo-styles.css" rel="Stylesheet">
<link href="styles/font-jb-sans-auto.css" rel="Stylesheet">
<script type="text/javascript" src="scripts/clipboard.js" async="async"></script>
<script type="text/javascript" src="scripts/navigation-loader.js" async="async"></script>
<script type="text/javascript" src="scripts/platform-content-handler.js" async="async"></script>
<script type="text/javascript" src="scripts/main.js" defer="defer"></script>
<script type="text/javascript" src="scripts/prism.js" async="async"></script>
<script type="text/javascript" src="scripts/symbol-parameters-wrapper_deferred.js" defer="defer"></script>
</head>
<body>
    <div class="root">
<nav class="navigation" id="navigation-wrapper">
    <div class="navigation--inner">
        <div class="navigation-title">
            <button class="menu-toggle" id="menu-toggle" type="button">toggle menu</button>
            <div class="library-name">
                    <a class="library-name--link" href="index.html">
                            AXP Messaging
                    </a>
            </div>
            <div class="library-version">
0.2.0            </div>
        </div>
        <div class="filter-section" id="filter-section">
                <button class="platform-tag platform-selector jvm-like" data-active="" data-filter=":messaging:dokkaHtml/release">androidJvm</button>
        </div>
    </div>
    <div class="navigation-controls">
        <button class="navigation-controls--btn navigation-controls--theme" id="theme-toggle-button" type="button">switch theme</button>
        <div class="navigation-controls--btn navigation-controls--search" id="searchBar" role="button">search in API</div>
    </div>
</nav>
        <div id="container">
            <div class="sidebar" id="leftColumn">
                <div class="sidebar--inner" id="sideMenu"></div>
            </div>
            <div id="main">
<div class="main-content" id="content" pageIds="AXP Messaging::////PointingToDeclaration//1431436068">
  <div class="breadcrumbs"></div>
  <div class="cover ">
    <h1 class="cover"><span><span>AXP</span></span> <span><span>Messaging</span></span></h1>
    <div class="platform-hinted UnderCoverText" data-platform-hinted="data-platform-hinted"><div class="content sourceset-dependent-content" data-active="" data-togglable=":messaging:dokkaHtml/release"><p class="paragraph">The AXP Messaging module enables text messaging to agents in AXP. It works in conjunction with the AXP Core module, which establishes the necessary connections.</p><p class="paragraph">This enables asynchronous communication, allowing end users to resume conversation threads at any time and view all previous messages exchanged as part of the conversation. This is unlike a session-based chat, where the chat is closed after the participants disconnect the dialog.</p><h2 class="">Prerequisites</h2><p class="paragraph">To use the Messaging module, you need an Omni SDK integration provisioned with the <strong>Messaging</strong> service enabled. Follow the instructions in <a href="https://documentation.avaya.com/bundle/ExperiencePlatform_Administering_10/page/Creating_an_Omni_SDK_integration.html">Creating an Omni SDK Integration</a> to set up an integration with messaging support and use the integration ID for configuring the SDK as described in the documentation for the Core module.</p><h2 class="">Installation</h2><p class="paragraph">The AXP Messaging module is distributed via the Maven registry in GitHub Packages.</p><h3 class="">Maven Installation</h3><p class="paragraph">If you have a GitHub account, you can use it to download the package automatically from the registry.</p><h4 class="">Generate a Personal Access Token</h4><p class="paragraph">To download packages from the GitHub registry, you first need to generate an authentication token for your GitHub account.</p><p class="paragraph">To generate one, follow the instructions from <a href="https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens#creating-a-personal-access-token-classic">Creating a personal access token (classic)</a>. For the selected scopes, pick &quot;read:packages&quot;.</p><h4 class="">Add Repository</h4><p class="paragraph">To access the AXP SDK repository, add the following to your <code class="lang-kotlin">build.gradle</code> or <code class="lang-kotlin">settings.gradle</code> file:</p><div class="sample-container"><pre><code class="block lang-groovy" theme="idea">// For Groovy<br>repositories {<br>    maven {<br>        url = uri(&quot;https://maven.pkg.github.com/AvayaExperiencePlatform/omni-sdk-android&quot;)<br>        credentials {<br>            username = &quot;&lt;GITHUB-ACCOUNT&gt;&quot;<br>            password = &quot;&lt;GITHUB-TOKEN&gt;&quot;<br>        }<br>    }<br>}</code></pre><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div><p class="paragraph">or if using the Kotlin DSL, <code class="lang-kotlin">build.gradle.kts</code> or <code class="lang-kotlin">settings.gradle.kts</code> file:</p><div class="sample-container"><pre><code class="block lang-kotlin" theme="idea">// For Kotlin DSL<br>repositories {<br>    maven {<br>        url = uri(&quot;https://maven.pkg.github.com/AvayaExperiencePlatform/omni-sdk-android&quot;)<br>        credentials {<br>            username = &quot;&lt;GITHUB-ACCOUNT&gt;&quot;<br>            password = &quot;&lt;GITHUB-TOKEN&gt;&quot;<br>        }<br>    }<br>}</code></pre><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div><p class="paragraph">replacing <code class="lang-kotlin">&lt;GITHUB-ACCOUNT&gt;</code> with your GitHub user ID and <code class="lang-kotlin">&lt;GITHUB-TOKEN&gt;</code> with the token generated in the previous step.</p><h4 class="">Include Package</h4><p class="paragraph">To include the package in your project, add the following to your <code class="lang-kotlin">build.gradle</code> file:</p><div class="sample-container"><pre><code class="block lang-groovy" theme="idea">// For Groovy<br>dependencies {<br>    implementation 'com.avaya.sdk:core:${avayaSdkVersion}'<br>    implementation 'com.avaya.sdk:messaging:${avayaSdkVersion}'<br>}</code></pre><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div><p class="paragraph">or Kotlin <code class="lang-kotlin">build.gradle.kts</code> file:</p><div class="sample-container"><pre><code class="block lang-kotlin" theme="idea">// For Kotlin DSL<br>dependencies {<br>    implementation(&quot;com.avaya.sdk:core:${avayaSdkVersion}&quot;)<br>    implementation(&quot;com.avaya.sdk:messaging:${avayaSdkVersion}&quot;)<br>}</code></pre><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div><p class="paragraph">Replace <code class="lang-kotlin">${avayaSdkVersion}</code> with the latest version of the AXP SDK.</p><h3 class="">Manual Installation</h3><p class="paragraph">If you don't have or wish to use a GitHub account, you can download the package manually from <a href="https://github.com/AvayaExperiencePlatform/omni-sdk-android/packages/2150732">its package page</a>.</p><p class="paragraph">You'll also need to download the <a href="https://github.com/AvayaExperiencePlatform/omni-sdk-android/packages/2150727">Core module</a> that it depends on.</p><h4 class="">Include Package</h4><p class="paragraph">To include the package in your project, add the following to your <code class="lang-kotlin">build.gradle</code> file:</p><div class="sample-container"><pre><code class="block lang-groovy" theme="idea">// For Groovy<br>dependencies {<br>    implementation files('${path}/core-${avayaSdkVersion}.aar')<br>    implementation files('${path}/messaging-${avayaSdkVersion}.aar')<br>}</code></pre><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div><p class="paragraph">or Kotlin <code class="lang-kotlin">build.gradle.kts</code> file:</p><div class="sample-container"><pre><code class="block lang-kotlin" theme="idea">// For Kotlin DSL<br>dependencies {<br>    implementation(files(&quot;${path}/core-${avayaSdkVersion}.jar.aar&quot;))<br>    implementation(files(&quot;${path}/messaging-${avayaSdkVersion}.jar.aar&quot;))<br>}</code></pre><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div><p class="paragraph">Replace <code class="lang-kotlin">${avayaSdkVersion}</code> with the version number of the AXP SDK and <code class="lang-kotlin">${path}</code> with the directory you put the downloaded package files in.</p><h2 class="">Usage</h2><h3 class="">Conversation</h3><p class="paragraph">Before you can send a message, you need a valid <code class="lang-kotlin">Conversation</code>. You can obtain this by calling <code class="lang-kotlin">AxpClientSdk.getDefaultConversation()</code> from the AXP Core module.</p><p class="paragraph">Here's an example of getting the default conversation:</p><div class="sample-container"><pre><code class="block lang-kotlin" theme="idea">launch {<br>    when (val result = AxpClientSdk.getDefaultConversation()) {<br>        is AxpResult.Success -&gt; {<br>            val defaultConversation = result<br>            // Use the userSession to send a message<br>        }<br>        is AxpResult.Failure -&gt; {<br>            val error = result.error<br>            // Handle the error<br>        }<br>    }<br>}</code></pre><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div><h3 class="">Sending a Message</h3><p class="paragraph">Once you have a valid <code class="lang-kotlin">Conversation</code>, you can use it to send messages.</p><p class="paragraph">The AXP Messaging module supports various types of messages, including:</p><ul><li><p class="paragraph">Text (Plain text, Emojis, Links)</p></li><li><p class="paragraph">Postback</p></li><li><p class="paragraph">Reply</p></li><li><p class="paragraph">Attachment</p></li><li><p class="paragraph">Location</p></li></ul><p class="paragraph">To link a message to a previous message in the thread, each of the methods for sending a message has an optional parameter for the message ID of the parent message.</p><h4 class="">Sending a Plain Text Message</h4><div class="sample-container"><pre><code class="block lang-kotlin" theme="idea">val message = &quot;Hello, how can I help you?&quot;<br>conversation.sendMessage(message)</code></pre><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div><h4 class="">Sending a Location Message</h4><p class="paragraph">A location message includes latitude and longitude coordinates.</p><div class="sample-container"><pre><code class="block lang-kotlin" theme="idea">// LOCATION_NAME, ADDRESS_LINE, PARENT_MESSAGE_ID are optional<br>conversation.sendMessage(<br>    LocationMessage(latitude, longitude, LOCATION_NAME, ADDRESS_LINE),<br>    PARENT_MESSAGE_ID<br>)</code></pre><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div><h4 class="">Sending a Postback Message</h4><div class="sample-container"><pre><code class="block lang-kotlin" theme="idea">// PARENT_MESSAGE_ID is optional<br>conversation.sendMessage(PostbackMessage(text, payload), PARENT_MESSAGE_ID)</code></pre><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div><h4 class="">Sending a Reply Message</h4><div class="sample-container"><pre><code class="block lang-kotlin" theme="idea">// ICON_URL, PARENT_MESSAGE_ID are optional<br>conversation.sendMessage(ReplyMessage(text, payload, ICON_URL), PARENT_MESSAGE_ID)</code></pre><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div><h4 class="">Sending an Attachment Message</h4><p class="paragraph">An attachment message includes a file and other data.</p><div class="sample-container"><pre><code class="block lang-kotlin" theme="idea">// CAPTION, PARENT_MESSAGE_ID are optional<br>conversation.sendMessage(AttachmentMessage(file, CAPTION), PARENT_MESSAGE_ID)</code></pre><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div><h3 class="">Handling Exceptions When Sending Messages</h3><p class="paragraph">When you attempt to send a message, it's possible to encounter exceptions. In such cases, you can manage these exceptions by capturing the <code class="lang-kotlin">IllegalMessageBodyException</code>. This exception provides you with an error code, accessible via <code class="lang-kotlin">MessageBodyErrorCode</code>, and a reason for the exception.</p><h3 class="">Fetching Older Messages</h3><p class="paragraph">To fetch older messages from a conversation, use the <code class="lang-kotlin">getMessages</code> method, which returns a <code class="lang-kotlin">PageIterator&lt;Message&gt;</code>. This iterator can be used to cycle through the messages.</p><div class="sample-container"><pre><code class="block lang-kotlin" theme="idea">// The default page size is 10<br>val messageIterator = conversation.getMessages(pageSize = 10)<br>val firstPageOfMessages = messageIterator.items<br>if (messageIterator.hasNext()) {<br>    val nextMessagePage = messageIterator.next()<br>    val nextPageOfMessages = nextMessagePage.items<br>}</code></pre><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div><h3 class="">Receiving and Checking Delivery of Messages</h3><p class="paragraph">To receive the latest messages and check whether a message has been delivered to the server, you can add a listener to the conversation or observe the Flow of messages.</p><h4 class="">Receiving Messages via a Listener</h4><p class="paragraph">Here's how you can add a listener to receive the latest messages:</p><div class="sample-container"><pre><code class="block lang-kotlin" theme="idea">// Using a listener<br>val messageArrivedListener = MessageArrivedListener { message -&gt;<br>    // You can now use the received message<br>}<br>conversation.addMessageArrivedListener(messageArrivedListener)</code></pre><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div><p class="paragraph">Similarly, you can add a listener to check whether a message has been delivered to the server:</p><div class="sample-container"><pre><code class="block lang-kotlin" theme="idea">val messageDeliveredListener = MessageDeliveredListener { message -&gt;<br>    // You can now use the delivered message<br>}<br>conversation.addMessageDeliveredListener(messageDeliveredListener)</code></pre><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div><h4 class="">Receiving Messages via a Flow</h4><p class="paragraph">Here's how you can use the Flow to receive the latest messages:</p><div class="sample-container"><pre><code class="block lang-kotlin" theme="idea">conversation.messageArrivedFlow.collect { message -&gt;<br>    // You can now use the received message<br>}</code></pre><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div><p class="paragraph">Similarly, you can use the Flow to check whether a message has been delivered to the server:</p><div class="sample-container"><pre><code class="block lang-kotlin" theme="idea">conversation.messageDeliveredFlow.collect { message -&gt;<br>    // You can now use the delivered message<br>}</code></pre><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div><h3 class="">Monitoring Participant Changes</h3><p class="paragraph">You can monitor changes to the participants in a conversation by adding a listener to the conversation or by observing the flow.</p><div class="sample-container"><pre><code class="block lang-kotlin" theme="idea">// Using a listener<br>conversation.addParticipantsChangedListener { changedParticipants -&gt;<br>    // You can now use the set of changed participants<br>}</code></pre><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div><p class="paragraph">or</p><div class="sample-container"><pre><code class="block lang-kotlin" theme="idea">// Using flow<br>conversation.participantsFlow.collect { changedParticipants -&gt;<br>    // You can now use the set of changed participants<br>}</code></pre><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div><p class="paragraph">To access participants that are only related to messaging, you can get them by</p><div class="sample-container"><pre><code class="block lang-kotlin" theme="idea">val messagingParticipants = conversation.participants(AxpChannel.MESSAGING)</code></pre><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div></div></div>
  </div>
  <h2 class="">Packages</h2>
  <div class="table"><a data-name="-511733589%2FPackages%2F1431436068" anchor-label="com.avaya.axp.client.sdk.messaging" id="-511733589%2FPackages%2F1431436068" data-filterable-set=":messaging:dokkaHtml/release"></a>
    <div class="table-row" data-filterable-current=":messaging:dokkaHtml/release" data-filterable-set=":messaging:dokkaHtml/release">
      <div>
        <div class="main-subrow ">
          <div class=""><span class="inline-flex">
              <div><a href="-a-x-p -messaging/com.avaya.axp.client.sdk.messaging/index.html">com.avaya.axp.client.sdk.messaging</a></div>
<span class="anchor-wrapper"><span class="anchor-icon" pointing-to="-511733589%2FPackages%2F1431436068"></span>
                <div class="copy-popup-wrapper "><span class="copy-popup-icon"></span><span>Link copied to clipboard</span></div>
              </span></span></div>
          <div class="pull-right">
            <div class="platform-tags no-gutters">
              <div class="platform-tag jvm-like">androidJvm</div>
            </div>
          </div>
        </div>
        <div></div>
      </div>
    </div>
  </div>
</div>
      <div class="footer">
        <span class="go-to-top-icon"><a href="#content" id="go-to-top-link"></a></span><span>© 2024 Copyright</span><span
                class="pull-right"><span>Generated by </span><a
                href="https://github.com/Kotlin/dokka"><span>dokka</span><span class="padded-icon"></span></a></span>
      </div>
            </div>
        </div>
    </div>
</body>
</html>
